/*
 * QueryLoader v2 - A simple script to create a preloader for images
 *
 * For instructions read the original post:
 * http://www.gayadesign.com/diy/queryloader2-preload-your-images-with-ease/
 *
 * Copyright (c) 2011 - Gaya Kessler
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Version:  2.9.0
 * Last update: 2014-01-31
 */
(function(e){function t(e){this.parent=e;this.container;this.loadbar;this.percentageContainer}function n(e){this.toPreload=[];this.parent=e;this.container}function r(e){this.element;this.parent=e}function i(r,i){this.element=r;this.$element=e(r);this.options=i;this.foundUrls=[];this.destroyed=false;this.imageCounter=0;this.imageDone=0;this.alreadyLoaded=false;this.preloadContainer=new n(this);this.overlayLoader=new t(this);this.defaultOptions={onComplete:function(){},onLoadComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:false,deepSearch:true,completeAnimation:"fade",minimumTime:500};this.init()}(function(e){"use strict";function r(t){var n=e.event;n.target=n.target||n.srcElement||t;return n}var t=document.documentElement;var n=function(){};if(t.addEventListener){n=function(e,t,n){e.addEventListener(t,n,false)}}else if(t.attachEvent){n=function(e,t,n){e[t+n]=n.handleEvent?function(){var t=r(e);n.handleEvent.call(n,t)}:function(){var t=r(e);n.call(e,t)};e.attachEvent("on"+t,e[t+n])}}var i=function(){};if(t.removeEventListener){i=function(e,t,n){e.removeEventListener(t,n,false)}}else if(t.detachEvent){i=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(r){e[t+n]=undefined}}}var s={bind:n,unbind:i};if(typeof define==="function"&&define.amd){define(s)}else if(typeof exports==="object"){module.exports=s}else{e.eventie=s}})(this);(function(){"use strict";function e(){}function i(e,t){var n=e.length;while(n--){if(e[n].listener===t){return n}}return-1}function s(e){return function(){return this[e].apply(this,arguments)}}var t=e.prototype;var n=this;var r=n.EventEmitter;t.getListeners=function(t){var n=this._getEvents();var r;var i;if(t instanceof RegExp){r={};for(i in n){if(n.hasOwnProperty(i)&&t.test(i)){r[i]=n[i]}}}else{r=n[t]||(n[t]=[])}return r};t.flattenListeners=function(t){var n=[];var r;for(r=0;r<t.length;r+=1){n.push(t[r].listener)}return n};t.getListenersAsObject=function(t){var n=this.getListeners(t);var r;if(n instanceof Array){r={};r[t]=n}return r||n};t.addListener=function(t,n){var r=this.getListenersAsObject(t);var s=typeof n==="object";var o;for(o in r){if(r.hasOwnProperty(o)&&i(r[o],n)===-1){r[o].push(s?n:{listener:n,once:false})}}return this};t.on=s("addListener");t.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:true})};t.once=s("addOnceListener");t.defineEvent=function(t){this.getListeners(t);return this};t.defineEvents=function(t){for(var n=0;n<t.length;n+=1){this.defineEvent(t[n])}return this};t.removeListener=function(t,n){var r=this.getListenersAsObject(t);var s;var o;for(o in r){if(r.hasOwnProperty(o)){s=i(r[o],n);if(s!==-1){r[o].splice(s,1)}}}return this};t.off=s("removeListener");t.addListeners=function(t,n){return this.manipulateListeners(false,t,n)};t.removeListeners=function(t,n){return this.manipulateListeners(true,t,n)};t.manipulateListeners=function(t,n,r){var i;var s;var o=t?this.removeListener:this.addListener;var u=t?this.removeListeners:this.addListeners;if(typeof n==="object"&&!(n instanceof RegExp)){for(i in n){if(n.hasOwnProperty(i)&&(s=n[i])){if(typeof s==="function"){o.call(this,i,s)}else{u.call(this,i,s)}}}}else{i=r.length;while(i--){o.call(this,n,r[i])}}return this};t.removeEvent=function(t){var n=typeof t;var r=this._getEvents();var i;if(n==="string"){delete r[t]}else if(t instanceof RegExp){for(i in r){if(r.hasOwnProperty(i)&&t.test(i)){delete r[i]}}}else{delete this._events}return this};t.removeAllListeners=s("removeEvent");t.emitEvent=function(t,n){var r=this.getListenersAsObject(t);var i;var s;var o;var u;for(o in r){if(r.hasOwnProperty(o)){s=r[o].length;while(s--){i=r[o][s];if(i.once===true){this.removeListener(t,i.listener)}u=i.listener.apply(this,n||[]);if(u===this._getOnceReturnValue()){this.removeListener(t,i.listener)}}}}return this};t.trigger=s("emitEvent");t.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)};t.setOnceReturnValue=function(t){this._onceReturnValue=t;return this};t._getOnceReturnValue=function(){if(this.hasOwnProperty("_onceReturnValue")){return this._onceReturnValue}else{return true}};t._getEvents=function(){return this._events||(this._events={})};e.noConflict=function(){n.EventEmitter=r;return e};if(typeof define==="function"&&define.amd){define(function(){return e})}else if(typeof module==="object"&&module.exports){module.exports=e}else{this.EventEmitter=e}}).call(this);(function(e,t){"use strict";if(typeof define==="function"&&define.amd){define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,r){return t(e,n,r)})}else if(typeof exports==="object"){module.exports=t(e,require("eventEmitter"),require("eventie"))}else{e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}})(this,function(t,n,r){"use strict";function u(e,t){for(var n in t){e[n]=t[n]}return e}function f(e){return a.call(e)==="[object Array]"}function l(e){var t=[];if(f(e)){t=e}else if(typeof e.length==="number"){for(var n=0,r=e.length;n<r;n++){t.push(e[n])}}else{t.push(e)}return t}function c(e,t,n){if(!(this instanceof c)){return new c(e,t)}if(typeof e==="string"){e=document.querySelectorAll(e)}this.elements=l(e);this.options=u({},this.options);if(typeof t==="function"){n=t}else{u(this.options,t)}if(n){this.on("always",n)}this.getImages();if(i){this.jqDeferred=new i.Deferred}var r=this;setTimeout(function(){r.check()})}function h(e){this.img=e}function d(e){this.src=e;p[e]=this}var i=t.jQuery;var s=t.console;var o=typeof s!=="undefined";var a=Object.prototype.toString;c.prototype=new n;c.prototype.options={};c.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;e<t;e++){var n=this.elements[e];if(n.nodeName==="IMG"){this.addImage(n)}var r=n.querySelectorAll("img");for(var i=0,s=r.length;i<s;i++){var o=r[i];this.addImage(o)}}};c.prototype.addImage=function(e){var t=new h(e);this.images.push(t)};c.prototype.check=function(){function r(r,i){if(e.options.debug&&o){}e.progress(r);t++;if(t===n){e.complete()}return true}var e=this;var t=0;var n=this.images.length;this.hasAnyBroken=false;if(!n){this.complete();return}for(var i=0;i<n;i++){var s=this.images[i];s.on("confirm",r);s.check()}};c.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e);if(t.jqDeferred&&t.jqDeferred.notify){t.jqDeferred.notify(t,e)}})};c.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=true;var t=this;setTimeout(function(){t.emit(e,t);t.emit("always",t);if(t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})};if(i){i.fn.imagesLoaded=function(e,t){var n=new c(this,e,t);return n.jqDeferred.promise(i(this))}}h.prototype=new n;h.prototype.check=function(){var e=p[this.img.src]||new d(this.img.src);if(e.isConfirmed){this.confirm(e.isLoaded,"cached was confirmed");return}if(this.img.complete&&this.img.naturalWidth!==undefined){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}var t=this;e.on("confirm",function(e,n){t.confirm(e.isLoaded,n);return true});e.check()};h.prototype.confirm=function(e,t){this.isLoaded=e;this.emit("confirm",this,t)};var p={};d.prototype=new n;d.prototype.check=function(){if(this.isChecked){return}var e=new Image;r.bind(e,"load",this);r.bind(e,"error",this);e.src=this.src;this.isChecked=true};d.prototype.handleEvent=function(e){var t="on"+e.type;if(this[t]){this[t](e)}};d.prototype.onload=function(e){this.confirm(true,"onload");this.unbindProxyEvents(e)};d.prototype.onerror=function(e){this.confirm(false,"onerror");this.unbindProxyEvents(e)};d.prototype.confirm=function(e,t){this.isConfirmed=true;this.isLoaded=e;this.emit("confirm",this,t)};d.prototype.unbindProxyEvents=function(e){r.unbind(e.target,"load",this);r.unbind(e.target,"error",this)};return c});t.prototype.createOverlay=function(){var t="absolute";if(this.parent.element.tagName.toLowerCase()=="body"){t="fixed"}else{var n=this.parent.$element.css("position");if(n!="fixed"||n!="absolute"){this.parent.$element.css("position","relative")}}this.container=e("<div id='"+this.parent.options.overlayId+"'></div>").css({width:"100%",height:"100%",backgroundColor:this.parent.options.backgroundColor,backgroundPosition:"fixed",position:t,zIndex:666999,top:0,left:0}).appendTo(this.parent.$element);this.loadbar=e("<div id='qLbar'></div>").css({height:this.parent.options.barHeight+"px",marginTop:"-"+this.parent.options.barHeight/2+"px",backgroundColor:this.parent.options.barColor,width:"0%",position:"absolute",top:"50%"}).appendTo(this.container);if(this.parent.options.percentage==true){this.percentageContainer=e("<div id='qLpercentage'></div>").text("0%").css({height:"40px",width:"100px",position:"absolute",fontSize:"3em",top:"50%",left:"50%",marginTop:"-"+(59+this.parent.options.barHeight)+"px",textAlign:"center",marginLeft:"-50px",color:this.parent.options.barColor}).appendTo(this.container)}if(!this.parent.preloadContainer.toPreload.length||this.parent.alreadyLoaded==true){this.parent.destroyContainers()}};t.prototype.updatePercentage=function(e){this.loadbar.stop().animate({width:e+"%",minWidth:e+"%"},200);if(this.parent.options.percentage==true){this.percentageContainer.text(Math.ceil(e)+"%")}};n.prototype.create=function(){this.container=e("<div></div>").appendTo("body").css({display:"none",width:0,height:0,overflow:"hidden"});this.processQueue()};n.prototype.processQueue=function(){for(var e=0;this.toPreload.length>e;e++){if(!this.parent.destroyed){this.preloadImage(this.toPreload[e])}}};n.prototype.addImage=function(e){this.toPreload.push(e)};n.prototype.preloadImage=function(e){var t=new r;t.addToPreloader(this,e);t.bindLoadEvent()};r.prototype.addToPreloader=function(t,n){this.element=e("<img />").attr("src",n);this.element.appendTo(t.container);this.parent=t.parent};r.prototype.bindLoadEvent=function(){this.parent.imageCounter++;this.element[0].ref=this;new imagesLoaded(this.element,function(e){e.elements[0].ref.completeLoading()})};r.prototype.completeLoading=function(){this.parent.imageDone++;var e=this.parent.imageDone/this.parent.imageCounter*100;this.parent.overlayLoader.updatePercentage(e);if(this.parent.imageDone==this.parent.imageCounter||e>=100){this.parent.endLoader()}};i.prototype.init=function(){this.options=e.extend({},this.defaultOptions,this.options);var t=this.findImageInElement(this.element);if(this.options.deepSearch==true){var n=this.$element.find("*:not(script)");for(var r=0;r<n.length;r++){this.findImageInElement(n[r])}}this.preloadContainer.create();this.overlayLoader.createOverlay()};i.prototype.findImageInElement=function(t){var n="";var i=e(t);var s="normal";if(i.css("background-image")!="none"){n=i.css("background-image");s="background"}else if(typeof i.attr("src")!="undefined"&&t.nodeName.toLowerCase()=="img"){n=i.attr("src")}if(!this.hasGradient(n)){n=this.stripUrl(n);var o=n.split(", ");for(var u=0;u<o.length;u++){if(this.validUrl(o[u])&&this.urlIsNew(o[u])){var a="";if(this.isIE()||this.isOpera()){a="?rand="+Math.random();this.preloadContainer.addImage(o[u]+a)}else{if(s=="background"){this.preloadContainer.addImage(o[u]+a)}else{var f=new r(this);f.element=i;f.bindLoadEvent()}}this.foundUrls.push(o[u])}}}};i.prototype.hasGradient=function(e){if(e.indexOf("gradient")==-1){return false}else{return true}};i.prototype.stripUrl=function(e){e=e.replace(/url\(\"/g,"");e=e.replace(/url\(/g,"");e=e.replace(/\"\)/g,"");e=e.replace(/\)/g,"");return e};i.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)};i.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)};i.prototype.validUrl=function(e){if(e.length>0&&!e.match(/^(data:)/i)){return true}else{return false}};i.prototype.urlIsNew=function(e){if(this.foundUrls.indexOf(e)==-1){return true}else{return false}};i.prototype.destroyContainers=function(){this.destroyed=true;this.preloadContainer.container.remove();this.overlayLoader.container.remove()};i.prototype.endLoader=function(){this.destroyed=true;this.onLoadComplete()};i.prototype.onLoadComplete=function(){this.options.onLoadComplete();if(this.options.completeAnimation=="grow"){var t=this.options.minimumTime;this.overlayLoader.loadbar[0].parent=this;this.overlayLoader.loadbar.stop().animate({width:"100%"},t,function(){e(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent;this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers();this.parent.options.onComplete()})})})}else{var t=this.options.minimumTime;this.overlayLoader.container[0].parent=this;this.overlayLoader.container.fadeOut(t,function(){this.parent.destroyContainers();this.parent.options.onComplete()})}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var t=this.length>>>0;var n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n);if(n<0)n+=t;for(;n<t;n++){if(n in this&&this[n]===e)return n}return-1}}e.fn.queryLoader2=function(e){return this.each(function(){new i(this,e)})}})(jQuery)